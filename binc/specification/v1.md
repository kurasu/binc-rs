# Specification for binc v1

## Variable length values

Lengths are stored with _variable length encoding_ in big-endian order.

Hence: MSB of a byte is used to indicate if another byte will follow, the remaining 7-bits are used for the value.

Examples:

| Value | Encoded (Hex) |
|-------|---------------|
| 20    | 0x14          |
| 127   | 0x7x          |
| 128   | 0x8100        |

Variable length values are noted to take 1+ bytes of size in the specification.

## File contents

A binc file consists of a _file header_ followed by any number of _changes_. Since the change header includes the data
size,
it is possible to skip or store unknown change types as bytes.

File Header

| Bytes | Payload        |
|-------|----------------|
| 4     | format: 'binc' |
| 4     | version: 1     |

Change Header (+ data)

| Bytes    | Payload         |
|----------|-----------------|
| 1+       | change type ID  |
| 1+       | datasize        |
| datasize | change data ... |

## Concepts

### Nodes

_Nodes_ are generic data structures that can store other _Nodes_ as well as _Attributes_.

### Node ID

A node-id is a (variable-length) integer value which is unique within the container. A file should start a

There is a pre-existing root node with ID 0.

## Changes

### Add Node

change type ID = 1

Adds a new node to the container.

| Bytes | Payload                         |
|-------|---------------------------------|
| 1+    | node id for new node            |
| 1+    | parent node id (root node is 0) |
| 1+    | index in parent node            |

### Move Node

change type ID = 3

Moves a node to a new parent node.

| Bytes | Payload                  |
|-------|--------------------------|
| 1+    | node id                  |
| 1+    | new parent node id       |
| 1+    | index in new parent node |

### Remove Node

change type ID = 2

Removes a node from the container.

| Bytes | Payload |
|-------|---------|
| 1+    | node id |

### Set Type

change type ID = 16

Sets the type of a node.

| Bytes | Payload |
|-------|---------|
| 1+    | node id |
| 1+    | type id |

### Set Name

change type ID = 17

Sets the name of a node.

| Bytes | Payload |
|-------|---------|
| 1+    | node id |
| 1+    | name    |

### Define Type Name

change type ID = 18

Defines a user-readable name for a type.

| Bytes | Payload |
|-------|---------|
| 1+    | type id |
| 1+    | name    |

### Define Attribute Name

change type ID = 19

Defines a user-readable name for an attribute.

| Bytes | Payload      |
|-------|--------------|
| 1+    | attribute id |
| 1+    | name         |

### Define Tag Name

change type ID = 20

Defines a user-readable name for a tag.

| Bytes | Payload |
|-------|---------|
| 1+    | tag id  |
| 1+    | name    |

### Add Tag

change type ID = 24

Adds a tag to a node.

| Bytes | Payload |
|-------|---------|
| 1+    | node id |
| 1+    | tag id  |

### Remove Tag

change type ID = 25

Removes a tag from a node.

| Bytes | Payload |
|-------|---------|
| 1+    | node id |
| 1+    | tag id  |

